# セキュリティポリシー

## 🛡️ 実装済みのセキュリティ対策

### 1. CSRF（クロスサイトリクエストフォージェリ）保護
- **実装**: Flask-WTF による CSRF トークン
- **効果**: 悪意のあるサイトからの不正なリクエストを防止
- **状態**: ✅ 実装済み

### 2. XSS（クロスサイトスクリプティング）対策
- **実装**: 
  - すべてのユーザー入力を `escape()` でサニタイズ
  - Jinja2 の自動エスケープ機能
- **効果**: 悪意のあるスクリプトの実行を防止
- **状態**: ✅ 実装済み

### 3. SQLインジェクション対策
- **実装**: SQLAlchemy ORM の使用
- **効果**: パラメータ化クエリにより SQL インジェクションを防止
- **状態**: ✅ 実装済み

### 4. セキュリティヘッダー
実装済みのヘッダー:
- `X-Content-Type-Options: nosniff` - MIME タイプスニッフィング防止
- `X-Frame-Options: SAMEORIGIN` - クリックジャッキング防止
- `X-XSS-Protection: 1; mode=block` - XSS フィルター有効化
- `Strict-Transport-Security` - HTTPS 強制（本番環境用）
- `Content-Security-Policy` - リソース読み込み制限

### 5. 入力値のバリデーション
- **文字列**: 最大長制限、HTMLエスケープ
- **整数**: 範囲チェック（min/max）
- **日付**: フォーマット検証
- **列挙型**: ホワイトリスト方式

### 6. シークレットキーの管理
- 環境変数からの読み込み
- ランダム生成（32バイト）
- ハードコード回避

## ⚠️ 既知の制限事項

### 1. 認証・認可
- **現状**: ユーザー認証なし（シングルユーザー前提）
- **リスク**: 同じPC上の他のユーザーがアクセス可能
- **推奨**: 
  - ローカルホスト（127.0.0.1）のみで使用
  - 外部ネットワークに公開しない

### 2. データ暗号化
- **現状**: データベースは平文で保存
- **リスク**: PC が盗まれた場合、データが読まれる可能性
- **推奨**:
  - PC にパスワード設定
  - ディスク暗号化（BitLocker 等）
  - 機密情報は入力しない

### 3. HTTPS
- **現状**: HTTP で動作（開発モード）
- **リスク**: 通信の盗聴（ただしローカルホストのみなので影響小）
- **推奨**: 本番環境では HTTPS を使用

## 🔒 セキュアな使用方法

### 開発者向け

1. **環境変数の設定**
```bash
# .env ファイルを作成
SECRET_KEY=your-random-secret-key-here
```

2. **本番環境での起動**
```python
# app.py の最後を変更
if __name__ == '__main__':
    with app.app_context():
        db.create_all()
    app.run(debug=False, host='127.0.0.1', port=5001)  # debug=False に変更
```

3. **定期的なアップデート**
```bash
pip install --upgrade Flask Flask-SQLAlchemy Flask-WTF
```

### ユーザー向け

1. **ローカルホストのみで使用**
   - 外部ネットワークに公開しない
   - `127.0.0.1` または `localhost` のみ

2. **PC のセキュリティ**
   - パスワードロック
   - ディスク暗号化
   - ウイルス対策ソフト

3. **データ保護**
   - 定期的なバックアップ
   - 機密情報は入力しない
   - バックアップファイルの安全な保管

## 🚨 脆弱性報告

セキュリティ上の問題を発見した場合：

1. **報告先**: 開発者に直接連絡
2. **報告内容**:
   - 脆弱性の詳細
   - 再現手順
   - 影響範囲
   - 修正案（あれば）

3. **対応**:
   - 24-48時間以内に確認
   - 重大な問題は優先対応
   - 修正版のリリース

## ✅ セキュリティチェックリスト

### 開発者
- [x] CSRF 保護
- [x] XSS 対策
- [x] SQL インジェクション対策
- [x] 入力値バリデーション
- [x] セキュリティヘッダー
- [x] シークレットキー管理
- [ ] ユーザー認証（今後の課題）
- [ ] データ暗号化（今後の課題）
- [ ] HTTPS 対応（本番環境）

### ユーザー
- [ ] ローカルホストのみで使用
- [ ] PC にパスワード設定
- [ ] 定期的なバックアップ
- [ ] 機密情報を入力しない
- [ ] ウイルス対策ソフト導入

## 📚 参考資料

- [OWASP Top 10](https://owasp.org/www-project-top-ten/)
- [Flask Security Best Practices](https://flask.palletsprojects.com/en/2.3.x/security/)
- [SQLAlchemy Security](https://docs.sqlalchemy.org/en/20/faq/security.html)

## 📝 更新履歴

- **2025-10-07**: 初版作成
  - CSRF 保護追加
  - XSS 対策追加
  - 入力値バリデーション追加
  - セキュリティヘッダー追加
